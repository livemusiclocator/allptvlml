(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[372,241],{2124:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/routes/[typeId]",function(){return r(3044)}])},2441:function(e,t,r){"use strict";r.d(t,{Z:function(){return Layout}});var s=r(5893),o=r(7294),n=r(1664),a=r.n(n),i=r(1163);function Header(){let[e,t]=(0,o.useState)(!1),r=(0,i.useRouter)(),toggleMenu=()=>{t(!e)},isActive=e=>r.pathname===e?"text-ptv-blue font-semibold":"text-gray-700 hover:text-ptv-blue";return(0,s.jsx)("header",{className:"bg-white shadow-sm",children:(0,s.jsxs)("div",{className:"container mx-auto px-4 py-4",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)(a(),{href:"/",className:"flex items-center space-x-2",children:(0,s.jsx)("span",{className:"text-xl font-bold text-ptv-blue",children:"PTV-LML"})}),(0,s.jsx)("button",{className:"md:hidden p-2 rounded-md text-gray-700 hover:bg-gray-100 focus:outline-none",onClick:toggleMenu,"aria-label":"Toggle menu",children:(0,s.jsx)("svg",{className:"h-6 w-6",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e?(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"}):(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})}),(0,s.jsxs)("nav",{className:"hidden md:flex space-x-8",children:[(0,s.jsx)(a(),{href:"/",className:"".concat(isActive("/")," transition-colors"),children:"Home"}),(0,s.jsx)(a(),{href:"/routes",className:"".concat(isActive("/routes")," transition-colors"),children:"Routes"}),(0,s.jsx)(a(),{href:"/allgigs",className:"".concat(isActive("/allgigs")," transition-colors"),children:"Live Music"}),(0,s.jsx)(a(),{href:"/about",className:"".concat(isActive("/about")," transition-colors"),children:"About"})]})]}),e&&(0,s.jsx)("nav",{className:"md:hidden mt-4 pt-4 border-t border-gray-200",children:(0,s.jsxs)("ul",{className:"space-y-4",children:[(0,s.jsx)("li",{children:(0,s.jsx)(a(),{href:"/",className:"".concat(isActive("/")," block py-2"),onClick:toggleMenu,children:"Home"})}),(0,s.jsx)("li",{children:(0,s.jsx)(a(),{href:"/routes",className:"".concat(isActive("/routes")," block py-2"),onClick:toggleMenu,children:"Routes"})}),(0,s.jsx)("li",{children:(0,s.jsx)(a(),{href:"/allgigs",className:"".concat(isActive("/allgigs")," block py-2"),onClick:toggleMenu,children:"Live Music"})}),(0,s.jsx)("li",{children:(0,s.jsx)(a(),{href:"/about",className:"".concat(isActive("/about")," block py-2"),onClick:toggleMenu,children:"About"})})]})})]})})}var l=r(5675),c=r.n(l);function Footer(){let e=new Date().getFullYear();return(0,s.jsx)("footer",{className:"bg-gray-800 text-white py-8",children:(0,s.jsxs)("div",{className:"container mx-auto px-4",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex items-center mb-4",children:[(0,s.jsx)(c(),{src:"/images/LML_1_RGB.png",alt:"Live Music Locator Logo",width:80,height:80,className:"mr-3"}),(0,s.jsx)("h3",{className:"text-lg font-semibold",children:"PTV-LML"})]}),(0,s.jsx)("p",{className:"text-gray-300 text-sm",children:"A web application that displays Public Transport Victoria route information (including SkyBus) and integrates with live music gig data."}),(0,s.jsx)("p",{className:"text-gray-300 text-sm mt-2",children:(0,s.jsx)("a",{href:"http://lml.live",target:"_blank",rel:"noopener noreferrer",className:"text-blue-400 hover:text-blue-300 transition-colors",children:"Powered by Live Music Locator technology"})})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Quick Links"}),(0,s.jsxs)("ul",{className:"space-y-2 text-gray-300 text-sm",children:[(0,s.jsx)("li",{children:(0,s.jsx)(a(),{href:"/",className:"hover:text-white transition-colors",children:"Home"})}),(0,s.jsx)("li",{children:(0,s.jsx)(a(),{href:"/routes",className:"hover:text-white transition-colors",children:"Routes"})}),(0,s.jsx)("li",{children:(0,s.jsx)(a(),{href:"/allgigs",className:"hover:text-white transition-colors",children:"Live Music"})}),(0,s.jsx)("li",{children:(0,s.jsx)(a(),{href:"/about",className:"hover:text-white transition-colors",children:"About"})})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"External Resources"}),(0,s.jsxs)("ul",{className:"space-y-2 text-gray-300 text-sm",children:[(0,s.jsx)("li",{children:(0,s.jsx)("a",{href:"https://www.ptv.vic.gov.au/",target:"_blank",rel:"noopener noreferrer",className:"hover:text-white transition-colors",children:"PTV Official Website"})}),(0,s.jsx)("li",{children:(0,s.jsx)("a",{href:"https://www.ptv.vic.gov.au/footer/data-and-reporting/datasets/ptv-timetable-api/",target:"_blank",rel:"noopener noreferrer",className:"hover:text-white transition-colors",children:"PTV API Documentation"})}),(0,s.jsx)("li",{children:(0,s.jsx)("a",{href:"http://lml.live",target:"_blank",rel:"noopener noreferrer",className:"hover:text-white transition-colors",children:"Live Music Locator"})}),(0,s.jsx)("li",{children:(0,s.jsx)("a",{href:"https://github.com/yourusername/ptv-lml",target:"_blank",rel:"noopener noreferrer",className:"hover:text-white transition-colors",children:"GitHub Repository"})})]})]})]}),(0,s.jsxs)("div",{className:"border-t border-gray-700 mt-8 pt-6 text-center text-sm text-gray-400",children:[(0,s.jsxs)("p",{children:["\xa9 ",e," PTV-LML. All rights reserved."]}),(0,s.jsxs)("p",{className:"mt-2",children:["PTV data is used under ",(0,s.jsx)("a",{href:"https://www.ptv.vic.gov.au/footer/data-and-reporting/datasets/",target:"_blank",rel:"noopener noreferrer",className:"text-blue-400 hover:text-blue-300",children:"Creative Commons Attribution 4.0 International license"}),"."]}),(0,s.jsx)("p",{className:"mt-2",children:"This is an unofficial application and is not affiliated with Public Transport Victoria."}),(0,s.jsxs)("p",{className:"mt-2",children:["Live Music Locator technology used with permission. Visit ",(0,s.jsx)("a",{href:"http://lml.live",target:"_blank",rel:"noopener noreferrer",className:"text-blue-400 hover:text-blue-300",children:"lml.live"})," for more information."]})]})]})})}function Layout(e){let{children:t}=e;return(0,s.jsxs)("div",{className:"flex flex-col min-h-screen",children:[(0,s.jsx)(Header,{}),(0,s.jsx)("main",{className:"flex-grow",children:t}),(0,s.jsx)(Footer,{})]})}},1241:function(e,t,r){"use strict";r.d(t,{Xo:function(){return getRoutesByType},Z$:function(){return getEstimatedTravelTime},Zx:function(){return getRouteDirections},getRouteTypes:function(){return getRouteTypes},rN:function(){return getRouteStops}});var s=r(7066),o=r(2474),n=r.n(o),a=r(1876).Buffer;let i="3002834",l="f36b2876-d136-485d-8e06-f057c79c0998";console.log("PTV API Configuration:"),console.log("DEV_ID:",i),console.log("API_KEY exists:",!!l);let PTVApiError=class PTVApiError extends Error{constructor(e,t){super(e),this.name="PTVApiError",this.status=t}};async function generateSignature(e){let t;if(console.log("Generating signature for request:",e),!l)throw console.error("API Key is not defined"),Error("PTV API key is not defined");if(!i)throw console.error("Developer ID is not defined"),Error("PTV Developer ID is not defined");e.includes("devid=")?(console.log("Request already has devid parameter, using as is"),t=e):t=e+(e.includes("?")?"&":"?")+"devid="+i,console.log("Request with DevID:",t);try{console.log("Running in browser environment");try{console.log("Attempting to use SubtleCrypto API");let e=new TextEncoder,r=e.encode(l),s=e.encode(t),o=await window.crypto.subtle.importKey("raw",r,{name:"HMAC",hash:"SHA-1"},!1,["sign"]),n=await window.crypto.subtle.sign("HMAC",o,s),a=Array.from(new Uint8Array(n)),i=a.map(e=>e.toString(16).padStart(2,"0")).join(""),c=i.toUpperCase();return console.log("Generated signature using SubtleCrypto:",c.substring(0,6)+"..."),c}catch(e){console.error("SubtleCrypto failed:",e),console.log("Falling back to server-side implementation")}let e=a.from(l,"utf-8"),r=n().createHmac("sha1",e);r.update(t);let s=r.digest("hex").toUpperCase();return console.log("Generated signature using Node.js crypto:",s.substring(0,6)+"..."),s}catch(e){throw console.error("Error generating signature:",e),e instanceof Error&&console.error("Error details:",{name:e.name,message:e.message,stack:e.stack}),Error("Failed to generate signature: ".concat(e instanceof Error?e.message:String(e)))}}async function ptvApiRequest(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(console.log("PTV API Request - Endpoint: ".concat(e)),!i)throw console.error("PTV API Error: Developer ID is not defined"),Error("PTV Developer ID is not defined");let r=new URLSearchParams;Object.entries(t).forEach(e=>{let[t,s]=e;r.append(t,String(s))});let o=e+(Object.keys(t).length>0?"?"+r.toString():"");console.log("Request Path (before devid): ".concat(o)),console.log("Using Developer ID: ".concat(i.substring(0,3),"..."));try{let t=await generateSignature(o);console.log("Generated Signature: ".concat(t.substring(0,6),"...")),r.append("devid",i),r.append("signature",t);let n="".concat("https://timetableapi.ptv.vic.gov.au").concat(e,"?").concat(r.toString());console.log("Full API URL: ".concat(n)),console.log("Sending API request...");let a=await s.Z.get(n);return console.log("API Response received:",{status:a.status,statusText:a.statusText,dataSize:JSON.stringify(a.data).length}),a.data}catch(e){if(console.error("PTV API Request failed:",e),s.Z.isAxiosError(e)){var n,a,l,c,u,d;if(console.error("Axios Error Details:",{status:null===(n=e.response)||void 0===n?void 0:n.status,statusText:null===(a=e.response)||void 0===a?void 0:a.statusText,data:null===(l=e.response)||void 0===l?void 0:l.data,message:e.message,config:{url:null===(c=e.config)||void 0===c?void 0:c.url,method:null===(u=e.config)||void 0===u?void 0:u.method,headers:null===(d=e.config)||void 0===d?void 0:d.headers}}),e.response)throw new PTVApiError("PTV API error: ".concat(e.response.status," ").concat(e.response.statusText),e.response.status)}throw Error("PTV API request failed: ".concat(e instanceof Error?e.message:String(e)))}}async function getRouteTypes(){return ptvApiRequest("/v3/route_types")}async function getRoutesByType(e){return ptvApiRequest("/v3/routes",{route_types:e})}async function getRouteDirections(e){return ptvApiRequest("/v3/directions/route/".concat(e))}async function getRouteStops(e,t,r){let s={};void 0!==r?(s.direction_id=r,console.log("Getting stops for route ".concat(e,", type ").concat(t,", direction ").concat(r))):console.log("WARNING: No direction_id specified for route ".concat(e,". Stops may not be in correct sequence.")),s.include_distance="true",console.log("Requesting stop_sequence information"),s.stop_disruptions="false",s.include_geopath="false",s.max_results=1e3;try{let r=await ptvApiRequest("/v3/stops/route/".concat(e,"/route_type/").concat(t),s);if(r&&r.stops&&r.stops.length>0){let e=r.stops;console.log("Received ".concat(e.length," stops with sequence info:"),e.slice(0,3).map(e=>({id:e.stop_id,name:e.stop_name,sequence:e.stop_sequence})))}return r}catch(r){throw console.error("Error fetching stops for route ".concat(e,", type ").concat(t,":"),r),r}}async function getStopDetails(e,t){return ptvApiRequest("/v3/stops/".concat(e,"/route_type/").concat(t),{stop_location:"true",stop_amenities:"true",stop_accessibility:"true"})}async function getJourneyBetweenStops(e,t,r){let s=new Date,o=new Date(s.toLocaleString("en-US",{timeZone:"Australia/Melbourne"})),n=o.toISOString().split("T")[0],a=o.toTimeString().split(" ")[0].substring(0,5);return ptvApiRequest("/v3/journey",{from_stop_id:e,to_stop_id:t,route_types:r,date:n,time:a,max_results:1})}async function getEstimatedTravelTime(e,t,r){try{let s=await getJourneyBetweenStops(e,t,r);if(s.journeys&&s.journeys.length>0)return s.journeys[0].duration_mins;throw Error("No journey data available")}catch(s){return console.error("Error getting travel time from PTV API:",s),estimateTravelTimeFallback(e,t,r)}}async function estimateTravelTimeFallback(e,t,r){try{let s=await getStopDetails(e,r),o=await getStopDetails(t,r),n=s.stop.stop_latitude,a=s.stop.stop_longitude,i=o.stop.stop_latitude,l=o.stop.stop_longitude,c=function(e,t,r,s){let o=(r-e)*(Math.PI/180),n=(s-t)*(Math.PI/180),a=Math.sin(o/2)*Math.sin(o/2)+Math.cos(e*(Math.PI/180))*Math.cos(r*(Math.PI/180))*Math.sin(n/2)*Math.sin(n/2);return 6371e3*(2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a)))}(n,a,i,l)/1e3,u={0:40,1:20,2:25,3:40,4:25,5:80}[r]||30;return Math.ceil(1.2*(60*(c/u)))}catch(e){return console.error("Error in fallback travel time estimation:",e),({0:5,1:3,2:4,3:10,4:4,5:15})[r]||5}}},3044:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return RoutesByType}});var s=r(5893),o=r(7294),n=r(1163),a=r(9008),i=r.n(a),l=r(1664),c=r.n(l),u=r(2441),d=r(1241);let h={0:"Train",1:"Tram",2:"Bus",3:"V/Line"},m={0:"train-blue",1:"tram-green",2:"bus-orange",3:"train-blue"};function RoutesByType(){let e=(0,n.useRouter)(),{typeId:t}=e.query,[r,a]=(0,o.useState)([]),[l,g]=(0,o.useState)(!0),[p,x]=(0,o.useState)(null),[f,v]=(0,o.useState)("");(0,o.useEffect)(()=>{if(!t)return;let fetchRoutes=async()=>{try{g(!0),x(null);try{let e=localStorage.getItem("routes_type_".concat(t));if(e){a(JSON.parse(e)),g(!1);let r=localStorage.getItem("routes_type_".concat(t,"_timestamp"));r&&Date.now()-parseInt(r)>864e5&&refreshRoutes();return}}catch(e){console.error("LocalStorage error:",e)}await refreshRoutes()}catch(e){x("Failed to load routes. Please try again later."),g(!1),console.error("Error fetching routes:",e)}},refreshRoutes=async()=>{try{var e;let r;console.log("Fetching routes for type ID: ".concat(t)),console.log("Environment check:",{devIdExists:!0,apiKeyExists:!0,nodeEnv:"production",basePath:"/ptv-lml"}),console.log("Using PTV API for route type ".concat(t)),r=await (0,d.Xo)(Number(t)),console.log("API Response received:",{status:r.status,routesCount:(null===(e=r.routes)||void 0===e?void 0:e.length)||0});let s=r.routes.sort((e,t)=>e.route_number&&t.route_number?e.route_number.localeCompare(t.route_number,void 0,{numeric:!0}):e.route_name.localeCompare(t.route_name));console.log("Sorted ".concat(s.length," routes")),a(s),g(!1);try{localStorage.setItem("routes_type_".concat(t),JSON.stringify(s)),localStorage.setItem("routes_type_".concat(t,"_timestamp"),Date.now().toString()),console.log("Routes cached successfully")}catch(e){console.error("LocalStorage saving error:",e)}}catch(e){throw console.error("Error in refreshRoutes:",e),e instanceof Error&&console.error("Error details:",{name:e.name,message:e.message,stack:e.stack}),e}};fetchRoutes()},[t,!0]);let b=r.filter(e=>e.route_name.toLowerCase().includes(f.toLowerCase())||e.route_number&&e.route_number.toLowerCase().includes(f.toLowerCase())),y=t&&h[t]||"Routes",j=t&&m[t]||"ptv-blue";return(0,s.jsxs)(u.Z,{children:[(0,s.jsx)(i(),{children:(0,s.jsxs)("title",{children:["PTV-LML | ",y," Routes"]})}),(0,s.jsxs)("div",{className:"container py-8",children:[(0,s.jsxs)("div",{className:"mb-8",children:[(0,s.jsxs)(c(),{href:"/",className:"text-ptv-blue hover:underline mb-4 inline-flex items-center",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-1",viewBox:"0 0 20 20",fill:"currentColor",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M9.707 14.707a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 1.414L7.414 9H15a1 1 0 110 2H7.414l2.293 2.293a1 1 0 010 1.414z",clipRule:"evenodd"})}),"Back to Home"]}),(0,s.jsxs)("h1",{className:"text-3xl font-bold text-".concat(j," mb-2 md:text-4xl"),children:[y," Routes"]}),(0,s.jsx)("p",{className:"text-gray-600",children:"Select a route to view its stops and live music events nearby."})]}),(0,s.jsx)("div",{className:"mb-6",children:(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("input",{type:"text",placeholder:"Search routes...",className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-ptv-blue",value:f,onChange:e=>v(e.target.value)}),(0,s.jsx)("svg",{className:"absolute right-3 top-2.5 h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z",clipRule:"evenodd"})})]})}),l?(0,s.jsx)("div",{className:"flex justify-center items-center py-12",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-ptv-blue"})}):p?(0,s.jsxs)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative",role:"alert",children:[(0,s.jsx)("strong",{className:"font-bold",children:"Error!"}),(0,s.jsxs)("span",{className:"block sm:inline",children:[" ",p]})]}):(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:b.length>0?b.map(e=>(0,s.jsx)(c(),{href:"/routes/".concat(t,"/").concat(e.route_id),className:"card hover:shadow-lg transition-shadow",children:(0,s.jsx)("div",{className:"p-4 border-l-4 border-ptv-blue",children:(0,s.jsxs)("div",{className:"flex items-center",children:[e.route_number&&(0,s.jsx)("span",{className:"text-white bg-".concat(j," px-2 py-1 rounded-md text-sm font-medium mr-3"),children:e.route_number}),(0,s.jsxs)("h2",{className:"text-lg font-semibold",children:[e.route_number&&1===Number(t)&&"Number ".concat(e.route_number,": "),e.route_number&&2===Number(t)&&"Route ".concat(e.route_number,": "),e.route_name]})]})})},e.route_id)):(0,s.jsx)("div",{className:"col-span-full text-center py-8",children:(0,s.jsxs)("p",{className:"text-gray-500",children:['No routes found matching "',f,'"']})})})]})]})}}},function(e){e.O(0,[714,664,675,66,817,774,888,179],function(){return e(e.s=2124)}),_N_E=e.O()}]);